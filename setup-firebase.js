const fs = require('fs');
const path = require('path');

function setupFirebaseEnv() {
  console.log('üîß Configuraci√≥n de Firebase para American Box');
  console.log('==============================================\n');

  console.log('üìã Necesitas tener listo tu archivo JSON de Firebase Service Account');
  console.log('   Desc√°rgalo desde: Firebase Console ‚Üí Project Settings ‚Üí Service Accounts\n');

  // Preguntar por las credenciales
  const readline = require('readline');
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });

  const questions = [
    { key: 'FIREBASE_PROJECT_ID', question: 'Project ID (ej: americanbox-e368b): ' },
    { key: 'FIREBASE_PRIVATE_KEY_ID', question: 'Private Key ID: ' },
    { key: 'FIREBASE_PRIVATE_KEY', question: 'Private Key (completa, con \\n): ' },
    { key: 'FIREBASE_CLIENT_EMAIL', question: 'Client Email: ' },
    { key: 'FIREBASE_CLIENT_ID', question: 'Client ID: ' },
    { key: 'FIREBASE_CLIENT_X509_CERT_URL', question: 'Client X509 Cert URL: ' }
  ];

  let answers = {};
  let currentIndex = 0;

  function askQuestion() {
    if (currentIndex >= questions.length) {
      // Todas las preguntas respondidas, crear archivo
      createEnvFile(answers);
      rl.close();
      return;
    }

    const q = questions[currentIndex];
    rl.question(q.question, (answer) => {
      answers[q.key] = answer;
      currentIndex++;
      askQuestion();
    });
  }

  function createEnvFile(envVars) {
    const envContent = `# Firebase Configuration - Generated by setup script
# Proyecto: ${envVars.FIREBASE_PROJECT_ID}

FIREBASE_PROJECT_ID=${envVars.FIREBASE_PROJECT_ID}
FIREBASE_PRIVATE_KEY_ID=${envVars.FIREBASE_PRIVATE_KEY_ID}
FIREBASE_PRIVATE_KEY="${envVars.FIREBASE_PRIVATE_KEY}"
FIREBASE_CLIENT_EMAIL=${envVars.FIREBASE_CLIENT_EMAIL}
FIREBASE_CLIENT_ID=${envVars.FIREBASE_CLIENT_ID}
FIREBASE_CLIENT_X509_CERT_URL=${envVars.FIREBASE_CLIENT_X509_CERT_URL}

# MySQL Database (para migraci√≥n)
DB_HOST=45.152.46.128
DB_USER=u582924658_American
DB_PASSWORD=1532DAnILO
DB_NAME=u582924658_American
DB_PORT=3306
`;

    const envPath = path.join(__dirname, '.env.migration');
    fs.writeFileSync(envPath, envContent);

    console.log('\n‚úÖ Archivo .env.migration creado exitosamente!');
    console.log('üìÅ Ubicaci√≥n:', envPath);
    console.log('\nüöÄ Pr√≥ximos pasos:');
    console.log('1. npm run test-firebase  # Probar conexi√≥n');
    console.log('2. npm run migrate        # Migrar datos');
    console.log('3. Configurar variables en Vercel');
  }

  askQuestion();
}

// Ejecutar si se llama directamente
if (require.main === module) {
  setupFirebaseEnv();
}

module.exports = { setupFirebaseEnv };